import{r,j as e,a,B as W,l as z,m as D,c as E,d as f,q as F,o as B,v as $,L as C,b as A,e as N,k as L,x as M,y as q,S as _,z as H,g as V}from"./index-Do7GzjIo.js";const I=({onPostCreated:t})=>{const[n,b]=r.useState(""),[m,S]=r.useState("public"),[p,x]=r.useState(null),[k,y]=r.useState(!1),R=g=>new Promise((v,s)=>{const i=new FileReader;i.readAsDataURL(g),i.onload=h=>{const w=new Image;w.src=h.target.result,w.onload=()=>{const l=document.createElement("canvas"),j=800,o=800;let c=w.width,d=w.height;c>d?c>j&&(d*=j/c,c=j):d>o&&(c*=o/d,d=o),l.width=c,l.height=d,l.getContext("2d").drawImage(w,0,0,c,d);const T=l.toDataURL("image/jpeg",.7);v(T)},w.onerror=l=>s(l)},i.onerror=h=>s(h)}),P=async g=>{const v=g.target.files[0];if(v)try{const s=await R(v);x(s)}catch(s){console.error("Compression error:",s),alert("Failed to process image.")}},U=async g=>{if(g.preventDefault(),!(!n.trim()&&!p)){y(!0);try{const v={uid:a.currentUser.uid,content:n.trim(),image:p,privacy:m,likes:[],commentsCount:0,shares:0,createdAt:z()};await D(E(f,"posts"),v),b(""),x(null),t&&t()}catch(v){console.error("Error creating post:",v),alert("Failed to post. Please try again.")}finally{y(!1)}}};return e.jsx("div",{className:"bg-surface rounded-xl border border-gray-800 p-4 mb-6 animate-fade-in",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-700 flex-shrink-0 overflow-hidden",children:a.currentUser?.photoURL?e.jsx("img",{src:a.currentUser.photoURL,alt:"User",className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-xs text-gray-400",children:"You"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:n,onChange:g=>b(g.target.value),placeholder:"What's on your mind, trader?",className:"w-full bg-gray-900/50 border border-gray-700 rounded-lg p-3 text-white focus:outline-none focus:border-primary min-h-[100px] resize-none"}),p&&e.jsxs("div",{className:"mt-2 relative inline-block",children:[e.jsx("img",{src:p,alt:"Preview",className:"h-32 rounded-lg border border-gray-700"}),e.jsx("button",{onClick:()=>x(null),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("div",{className:"flex gap-2 text-primary",children:[e.jsxs("label",{className:"cursor-pointer hover:bg-gray-800 p-2 rounded-full transition-colors flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{className:"text-sm",children:"Photo"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:m,onChange:g=>S(g.target.value),className:"bg-gray-800 text-gray-300 text-sm border border-gray-700 rounded-md py-1 px-2 focus:outline-none",children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"friends",children:"Friends Only"}),e.jsx("option",{value:"private",children:"Private"})]})})]}),e.jsx(W,{onClick:U,disabled:k||!n.trim()&&!p,children:k?"Posting...":"Post"})]})]})]})})},O=({post:t})=>{const[n,b]=r.useState(null),[m,S]=r.useState(t.likes?.includes(a.currentUser?.uid)),[p,x]=r.useState(t.likes?.length||0),[k,y]=r.useState(!1),[R,P]=r.useState([]),[U,g]=r.useState(""),[v,s]=r.useState(!1);r.useEffect(()=>{(async()=>{if(t.uid){const c=await A(N(f,"users",t.uid));c.exists()&&b(c.data())}})()},[t.uid]),r.useEffect(()=>{if(k){const o=F(E(f,"posts",t.id,"comments"),B("createdAt","asc")),c=$(o,d=>{P(d.docs.map(u=>({id:u.id,...u.data()})))});return()=>c()}},[k,t.id]);const i=async()=>{if(!a.currentUser)return;const o=m;S(!o),x(d=>o?d-1:d+1);const c=N(f,"posts",t.id);o?await L(c,{likes:M(a.currentUser.uid)}):await L(c,{likes:q(a.currentUser.uid)})},h=async o=>{if(o.preventDefault(),!!U.trim()){s(!0);try{await D(E(f,"posts",t.id,"comments"),{uid:a.currentUser.uid,username:a.currentUser.displayName||"User",content:U.trim(),createdAt:new Date}),await L(N(f,"posts",t.id),{commentsCount:(t.commentsCount||0)+1}),g("")}catch(c){console.error("Error commenting:",c)}finally{s(!1)}}},w=o=>{if(!o)return"Just now";const c=o.toDate?o.toDate():new Date(o),d=Math.floor((new Date-c)/1e3);let u=d/31536e3;return u>1?Math.floor(u)+"y":(u=d/2592e3,u>1?Math.floor(u)+"mo":(u=d/86400,u>1?Math.floor(u)+"d":(u=d/3600,u>1?Math.floor(u)+"h":(u=d/60,u>1?Math.floor(u)+"m":Math.floor(d)+"s"))))},l=n?.username||"Unknown User",j=n?.avatar_url||`https://ui-avatars.com/api/?name=${l}`;return e.jsxs("div",{className:"bg-surface rounded-xl border border-gray-800 mb-6 overflow-hidden animate-fade-in",children:[e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsx(C,{to:`/profile/${l}`,className:"block h-10 w-10 rounded-full overflow-hidden bg-gray-700",children:e.jsx("img",{src:j,alt:l,className:"h-full w-full object-cover"})}),e.jsxs("div",{children:[e.jsx(C,{to:`/profile/${l}`,className:"text-white font-bold hover:underline text-sm block",children:l}),e.jsxs("span",{className:"text-xs text-gray-500",children:[w(t.createdAt)," â€¢ ",t.privacy==="public"?"Public":t.privacy==="friends"?"Friends":"Private"]})]})]}),e.jsx("div",{className:"px-4 pb-2",children:e.jsx("p",{className:"text-gray-200 whitespace-pre-wrap",children:t.content})}),t.image&&e.jsx("div",{className:"w-full h-auto mt-2",children:e.jsx("img",{src:t.image,alt:"Post content",className:"w-full h-auto max-h-[500px] object-cover"})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-800 flex justify-between items-center mt-2",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("button",{onClick:i,className:`flex items-center gap-2 text-sm transition-colors ${m?"text-red-500":"text-gray-400 hover:text-red-500"}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ${m?"fill-current":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),p>0&&e.jsx("span",{children:p})]}),e.jsxs("button",{onClick:()=>y(!k),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-primary transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("span",{children:R.length||t.commentsCount||0})]}),e.jsx("button",{className:"flex items-center gap-2 text-sm text-gray-400 hover:text-green-500 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})]})}),k&&e.jsxs("div",{className:"bg-gray-900/30 p-4 border-t border-gray-800",children:[e.jsx("div",{className:"space-y-3 mb-4 max-h-60 overflow-y-auto",children:R.map(o=>e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-gray-700 flex-shrink-0"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-2 text-sm flex-1",children:[e.jsx("span",{className:"font-bold text-white mr-2",children:"Unknown"})," ",e.jsx("span",{className:"text-gray-300",children:o.content})]})]},o.id))}),e.jsxs("form",{onSubmit:h,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:U,onChange:o=>g(o.target.value),placeholder:"Write a comment...",className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-primary"}),e.jsx("button",{type:"submit",disabled:v||!U.trim(),className:"text-primary font-medium text-sm disabled:opacity-50",children:"Post"})]})]})]})},J=()=>{const[t,n]=r.useState("feed"),[b,m]=r.useState([]),[S,p]=r.useState(!0),[x,k]=r.useState([]),[y,R]=r.useState({sent:[],received:[]}),[P,U]=r.useState([]);r.useEffect(()=>{if(!a.currentUser)return;const s=$(N(f,"users",a.currentUser.uid),i=>{if(i.exists()){const h=i.data();k(h.friends||[]),R(h.friendRequests||{sent:[],received:[]})}});return()=>s()},[]),r.useEffect(()=>{x&&(async()=>{if(a.currentUser)try{const i=F(E(f,"users"),H(20)),w=(await V(i)).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.id!==a.currentUser.uid&&!x.includes(l.id)&&!y.sent?.includes(l.id)&&!y.received?.includes(l.id)).slice(0,5);U(w)}catch(i){console.error("Error fetching suggestions:",i)}})()},[x,y]),r.useEffect(()=>{const s=F(E(f,"posts"),B("createdAt","desc")),i=$(s,h=>{const l=h.docs.map(j=>({id:j.id,...j.data()})).filter(j=>j.uid===a.currentUser?.uid||j.privacy==="public"?!0:j.privacy==="friends"?x.includes(j.uid):!1);m(l),p(!1)});return()=>i()},[x]);const g=async s=>{try{const i=N(f,"users",a.currentUser.uid),h=N(f,"users",s);await L(i,{friends:q(s),"friendRequests.received":M(s)}),await L(h,{friends:q(a.currentUser.uid),"friendRequests.sent":M(a.currentUser.uid)}),alert("Friend request accepted!")}catch(i){console.error("Error accepting friend:",i)}},v=async s=>{try{const i=N(f,"users",a.currentUser.uid),h=N(f,"users",s);await L(i,{"friendRequests.received":M(s)}),await L(h,{"friendRequests.sent":M(a.currentUser.uid)})}catch(i){console.error("Error rejecting friend:",i)}};return e.jsxs("div",{className:"min-h-screen bg-background pt-20 pb-10",children:[e.jsx(_,{title:"Traders Community",description:"Connect with other traders, share ideas, and grow your network on ForexVolcano."}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Traders Community"}),e.jsxs("div",{className:"flex space-x-1 bg-surface p-1 rounded-lg border border-gray-800",children:[e.jsx("button",{onClick:()=>n("feed"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t==="feed"?"bg-primary text-white":"text-gray-400 hover:text-white"}`,children:"Feed"}),e.jsxs("button",{onClick:()=>n("friends"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t==="friends"?"bg-primary text-white":"text-gray-400 hover:text-white"}`,children:["Friends ",e.jsx("span",{className:"ml-1 bg-gray-800 text-xs px-2 py-0.5 rounded-full",children:x.length})]}),e.jsxs("button",{onClick:()=>n("requests"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t==="requests"?"bg-primary text-white":"text-gray-400 hover:text-white"}`,children:["Requests ",e.jsx("span",{className:"ml-1 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:y.received?.length||0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"hidden lg:block col-span-1",children:e.jsx("div",{className:"bg-surface rounded-xl border border-gray-800 p-6 sticky top-24",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(C,{to:`/profile/${a.currentUser?.displayName}`,className:"h-20 w-20 rounded-full bg-gray-700 overflow-hidden mb-4",children:e.jsx("img",{src:a.currentUser?.photoURL||"https://ui-avatars.com/api/?name=User",alt:"Me",className:"w-full h-full object-cover"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:a.currentUser?.displayName||"Trader"}),e.jsx("div",{className:"w-full border-t border-gray-800 my-4"}),e.jsxs("div",{className:"w-full flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Posts"}),e.jsx("span",{className:"text-white font-bold",children:b.filter(s=>s.uid===a.currentUser?.uid).length})]}),e.jsxs("div",{className:"w-full flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Friends"}),e.jsx("span",{className:"text-white font-bold",children:x.length})]})]})})}),e.jsxs("div",{className:"col-span-1 lg:col-span-2",children:[t==="feed"&&e.jsxs(e.Fragment,{children:[e.jsx(I,{}),S?e.jsx("div",{className:"text-center py-10 text-gray-400",children:"Loading community feed..."}):b.length>0?b.map(s=>e.jsx(O,{post:s},s.id)):e.jsx("div",{className:"text-center py-10 bg-surface rounded-xl border border-gray-800",children:e.jsx("p",{className:"text-gray-400",children:"No posts yet. Be the first to share something!"})})]}),t==="friends"&&e.jsxs("div",{className:"bg-surface rounded-xl border border-gray-800 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-6",children:"Your Friends"}),x.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:x.map(s=>e.jsx(X,{userId:s},s))}):e.jsx("p",{className:"text-gray-400",children:"No friends yet. Add people from the suggestions!"})]}),t==="requests"&&e.jsxs("div",{className:"bg-surface rounded-xl border border-gray-800 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-6",children:"Friend Requests"}),y.received?.length>0?e.jsx("div",{className:"space-y-4",children:y.received.map(s=>e.jsx(Y,{userId:s,onAccept:()=>g(s),onReject:()=>v(s)},s))}):e.jsx("p",{className:"text-gray-400",children:"No pending requests."})]})]}),e.jsx("div",{className:"hidden lg:block col-span-1",children:e.jsxs("div",{className:"bg-surface rounded-xl border border-gray-800 p-6 sticky top-24",children:[e.jsx("h3",{className:"text-white font-bold mb-4",children:"Suggested People"}),e.jsx("div",{className:"space-y-4",children:P.length>0?P.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(C,{to:`/profile/${s.username}`,className:"flex items-center gap-3 group",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-700 overflow-hidden",children:e.jsx("img",{src:s.avatar_url||`https://ui-avatars.com/api/?name=${s.username}`,alt:s.username,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"max-w-[100px]",children:e.jsx("p",{className:"text-sm font-bold text-white truncate group-hover:underline",children:s.username})})]}),e.jsx(C,{to:`/profile/${s.username}`,className:"text-primary text-xs hover:underline",children:"View"})]},s.id)):e.jsx("p",{className:"text-xs text-gray-500",children:"No suggestions available right now."})})]})})]})]})]})},X=({userId:t})=>{const[n,b]=r.useState(null);return r.useEffect(()=>{A(N(f,"users",t)).then(m=>{m.exists()&&b(m.data())})},[t]),n?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{to:`/profile/${n.username}`,className:"h-10 w-10 rounded-full bg-gray-700 overflow-hidden",children:e.jsx("img",{src:n.avatar_url||`https://ui-avatars.com/api/?name=${n.username}`,alt:n.username,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx(C,{to:`/profile/${n.username}`,className:"font-bold text-white hover:underline",children:n.username}),e.jsx("p",{className:"text-xs text-gray-500",children:"Trader"})]})]}),e.jsx(C,{to:`/profile/${n.username}`,className:"text-xs text-primary border border-primary px-3 py-1 rounded-full hover:bg-primary hover:text-white transition-colors",children:"View Profile"})]}):e.jsx("div",{className:"h-16 bg-gray-800 rounded-lg animate-pulse"})},Y=({userId:t,onAccept:n,onReject:b})=>{const[m,S]=r.useState(null);return r.useEffect(()=>{A(N(f,"users",t)).then(p=>{p.exists()&&S(p.data())})},[t]),m?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-700 overflow-hidden",children:e.jsx("img",{src:m.avatar_url||`https://ui-avatars.com/api/?name=${m.username}`,alt:m.username,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-white",children:m.username}),e.jsx("p",{className:"text-xs text-gray-500",children:"Wants to be your friend"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:n,className:"bg-primary hover:bg-green-600 text-white px-3 py-1 rounded-md text-xs font-bold",children:"Accept"}),e.jsx("button",{onClick:b,className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-xs font-bold",children:"Reject"})]})]}):e.jsx("div",{className:"h-16 bg-gray-800 rounded-lg animate-pulse"})};export{J as default};
