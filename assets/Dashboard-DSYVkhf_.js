import{r as l,a as C,j as e,L as D,B as k,e as E,d as U,b as B,g as I,c as L,s as $,q as P,w as R}from"./index-CdHir_gS.js";const M=({userProfile:s,setUserProfile:g})=>{const[i,j]=l.useState(s?.preferences||{newsImpacts:["High","Medium","Low"],analysisCurrencies:["XAUUSD","EURUSD","GBPUSD","BTCUSD","US30"],analysisTypes:["Technical","Fundamental"]}),[t,m]=l.useState(!1);l.useEffect(()=>{s?.preferences&&j(s.preferences)},[s]);const d=async()=>{m(!0);try{await $(E(U,"users",C.currentUser.uid),{preferences:i},{merge:!0}),g({...s,preferences:i}),alert("Preferences saved!")}catch(a){console.error("Error saving preferences:",a),alert("Failed to save.")}finally{m(!1)}},v=(a,x)=>{j(p=>{const r=p[a]||[];return r.includes(x)?{...p,[a]:r.filter(N=>N!==x)}:{...p,[a]:[...r,x]}})};return e.jsxs("div",{className:"bg-surface p-6 rounded-xl border border-gray-800 animate-fade-in",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Dashboard Customization"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"News Notifications"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Select which news impacts you want to see."}),e.jsx("div",{className:"flex gap-4",children:["High","Medium","Low"].map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.newsImpacts?.includes(a),onChange:()=>v("newsImpacts",a),className:"form-checkbox text-primary rounded bg-gray-900 border-gray-700"}),e.jsxs("span",{className:"text-gray-300",children:[a," Impact"]})]},a))})]}),e.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Analysis Filters"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Choose your favorite pairs to track."}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["XAUUSD","EURUSD","GBPUSD","USDJPY","BTCUSD","ETHUSD","US30","NAS100"].map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.analysisCurrencies?.includes(a),onChange:()=>v("analysisCurrencies",a),className:"form-checkbox text-primary rounded bg-gray-900 border-gray-700"}),e.jsx("span",{className:"text-gray-300",children:a})]},a))})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(k,{onClick:d,disabled:t,children:t?"Saving...":"Save Preferences"})})]})},z=({userProfile:s,setUserProfile:g})=>{const[i,j]=l.useState(s?.username||""),[t,m]=l.useState(s?.bio||""),[d,v]=l.useState(!1),[a,x]=l.useState(!1);l.useEffect(()=>{s&&(j(s.username||""),m(s.bio||""))},[s]);const p=n=>new Promise((f,c)=>{const w=new FileReader;w.readAsDataURL(n),w.onload=A=>{const h=new Image;h.src=A.target.result,h.onload=()=>{const b=document.createElement("canvas"),o=300,y=300;let u=h.width,S=h.height;u>S?u>o&&(S*=o/u,u=o):S>y&&(u*=y/S,S=y),b.width=u,b.height=S,b.getContext("2d").drawImage(h,0,0,u,S);const T=b.toDataURL("image/jpeg",.7);f(T)},h.onerror=b=>c(b)},w.onerror=A=>c(A)}),r=async n=>{const f=n.target.files[0];if(f){f.size>5*1024*1024&&console.log("Large file detected, compression will be applied."),v(!0);try{const c=await p(f);c.length>5e5&&console.warn("Image might be too large for smooth database performance"),await $(E(U,"users",C.currentUser.uid),{avatar_url:c},{merge:!0}),g({...s,avatar_url:c})}catch(c){console.error("Error processing image:",c),alert("Failed to process image.")}finally{v(!1)}}},N=async()=>{x(!0);try{if(i!==s?.username){if(!i.trim()){alert("Username cannot be empty"),x(!1);return}const n=P(L(U,"users"),R("username","==",i));if(!(await I(n)).empty){alert("Username is already taken. Please choose another."),x(!1);return}}await $(E(U,"users",C.currentUser.uid),{username:i,bio:t},{merge:!0}),g({...s,username:i,bio:t}),alert("Profile updated!")}catch(n){console.error("Error saving profile:",n),alert("Failed to save profile.")}finally{x(!1)}};return e.jsxs("div",{className:"bg-surface p-6 rounded-xl border border-gray-800 animate-fade-in",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Profile Settings"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"w-32 h-32 rounded-full overflow-hidden border-4 border-gray-800 relative group",children:[e.jsx("img",{src:s?.avatar_url||`https://ui-avatars.com/api/?name=${s?.username||"User"}`,alt:"Avatar",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx("span",{className:"text-xs text-white",children:"Change"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:r,className:"absolute inset-0 opacity-0 cursor-pointer"})]}),d&&e.jsx("span",{className:"text-xs text-primary",children:"Compressing & Saving..."})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Username (Public)"}),e.jsx("input",{type:"text",value:i,onChange:n=>j(n.target.value),className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:outline-none",placeholder:"e.g. CryptoKing"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Unique handle for your public profile."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Bio"}),e.jsx("textarea",{value:t,onChange:n=>m(n.target.value),className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-primary focus:outline-none h-24 resize-none",placeholder:"Tell us about your trading journey..."})]}),e.jsx("div",{children:e.jsx(k,{onClick:N,disabled:a,children:a?"Saving...":"Save Changes"})}),s?.username&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-900/50 rounded-lg border border-gray-800 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Your Public Profile:"}),e.jsx(D,{to:`/profile/${s.username}`,className:"text-primary hover:underline text-sm font-medium",children:"View Public Page â†’"})]})]})]})]})},H=()=>{const[s,g]=l.useState(null),[i,j]=l.useState(!0),[t,m]=l.useState("overview"),[d,v]=l.useState([]),[a,x]=l.useState({totalProgress:0,completed:0,avgQuiz:0});l.useEffect(()=>{(async()=>{if(C.currentUser)try{const N=E(U,"users",C.currentUser.uid),n=await B(N);n.exists()&&g(n.data());const f=await I(L(U,"users",C.currentUser.uid,"course_progress")),c={};if(f.docs.forEach(w=>{c[w.id]=w.data()}),Object.keys(c).length>0){const h=(await I(L(U,"courses"))).docs.map(o=>({id:o.id,...o.data()})).filter(o=>c[o.id]).map(o=>{const y=c[o.id],u=y.completedLessonIds?.length||0;return{...o,completedCount:u,lastAccessed:y.lastAccessed}});v(h);const b=h.reduce((o,y)=>o+y.completedCount,0);x({totalProgress:b,completed:h.length,avgQuiz:0})}}catch(N){console.error("Error fetching user data:",N)}finally{j(!1)}})()},[]);const p=s?.username||C.currentUser?.displayName||"Trader";return console.log("Dashboard Render",{loading:i,userProfile:s,activeTab:t}),e.jsxs("div",{className:"min-h-screen bg-background text-white animate-fade-in",children:[e.jsx("div",{className:"bg-surface border-b border-gray-800",children:e.jsx("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-gradient-to-br from-primary to-secondary p-[2px]",children:e.jsx("img",{src:s?.avatar_url||`https://ui-avatars.com/api/?name=${p}`,alt:"Profile",className:"h-full w-full rounded-full bg-background object-cover"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white",children:["Welcome back, ",e.jsx("span",{className:"text-primary",children:p})]}),e.jsx("p",{className:"mt-1 text-gray-400",children:"Ready to dominate the markets today?"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex space-x-6 mb-8 border-b border-gray-800 overflow-x-auto",children:[e.jsx("button",{onClick:()=>m("overview"),className:`pb-4 px-2 font-medium transition-colors whitespace-nowrap ${t==="overview"?"text-primary border-b-2 border-primary":"text-gray-400 hover:text-white"}`,children:"Overview"}),e.jsx("button",{onClick:()=>m("profile"),className:`pb-4 px-2 font-medium transition-colors whitespace-nowrap ${t==="profile"?"text-primary border-b-2 border-primary":"text-gray-400 hover:text-white"}`,children:"Profile"}),e.jsx("button",{onClick:()=>m("settings"),className:`pb-4 px-2 font-medium transition-colors whitespace-nowrap ${t==="settings"?"text-primary border-b-2 border-primary":"text-gray-400 hover:text-white"}`,children:"Settings & Preferences"}),e.jsx("button",{onClick:()=>m("learning"),className:`pb-4 px-2 font-medium transition-colors whitespace-nowrap ${t==="learning"?"text-primary border-b-2 border-primary":"text-gray-400 hover:text-white"}`,children:"My Learning"})]}),t==="overview"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Account Overview"}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3 mb-12",children:[e.jsx("div",{className:"bg-surface overflow-hidden shadow rounded-lg border border-gray-800",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-400 truncate",children:"Lessons Completed"}),e.jsx("dd",{className:"mt-1 text-3xl font-semibold text-white",children:a.totalProgress})]})}),e.jsx("div",{className:"bg-surface overflow-hidden shadow rounded-lg border border-gray-800",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-400 truncate",children:"Active Courses"}),e.jsx("dd",{className:"mt-1 text-3xl font-semibold text-primary",children:a.completed})]})}),e.jsx("div",{className:"bg-surface overflow-hidden shadow rounded-lg border border-gray-800",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-400 truncate",children:"Quiz Score Avg"}),e.jsx("dd",{className:"mt-1 text-3xl font-semibold text-secondary",children:"N/A"})]})})]}),d.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Jump Back In"}),e.jsxs("div",{className:"bg-surface rounded-xl p-6 border border-gray-800 flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"w-full md:w-1/3 aspect-video rounded-lg overflow-hidden",children:e.jsx("img",{src:d[0].image,alt:d[0].title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 w-full text-center md:text-left",children:[e.jsx("h4",{className:"text-xl font-bold text-white",children:d[0].title}),e.jsx("p",{className:"text-gray-400 mt-2 mb-4",children:"Continue where you left off."}),e.jsx(D,{to:`/academy/${d[0].path||"General"}/${d[0].id}`,children:e.jsx(k,{variant:"primary",children:"Continue Learning"})})]})]})]})]}),t==="profile"&&e.jsx(z,{userProfile:s,setUserProfile:g}),t==="settings"&&e.jsx(M,{userProfile:s,setUserProfile:g}),t==="learning"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Your Courses"}),e.jsx(D,{to:"/academy",className:"text-primary text-sm hover:underline",children:"Browse All Courses"})]}),d.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:d.map(r=>e.jsxs("div",{className:"bg-surface rounded-xl overflow-hidden border border-gray-800 hover:border-gray-600 transition-colors group",children:[e.jsxs("div",{className:"h-48 overflow-hidden relative",children:[e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(D,{to:`/academy/${r.path||"General"}/${r.id}`,children:e.jsx(k,{variant:"primary",size:"sm",children:"Continue Learning"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:r.title}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-1",children:[e.jsx("span",{children:"Lessons Completed"}),e.jsx("span",{children:r.completedCount})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-secondary",style:{width:`${Math.min(r.completedCount/10*100,100)}%`}})})]})]})]},r.id))}):e.jsxs("div",{className:"text-center py-20 bg-surface rounded-xl border border-gray-800",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"You haven't started any courses yet."}),e.jsx(D,{to:"/academy",children:e.jsx(k,{children:"Explore Academy"})})]})]})]})]})};export{H as default};
